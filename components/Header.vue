<!-- components/Header.vue -->
<template>
  <header
    class="header"
    :class="{ 'is-scrolled': isScrolled }"
    :style="{
      '--theme-text': currentTheme.text,
      '--theme-bg': currentTheme.bg,
    }"
  >
    <div class="grid-container">
      <nav class="header-nav">
        <!-- Menu -->
        <div class="header-menu">
          <ul class="menu-list">
            <li><NuxtLink class="t1-body" to="#projets">About us</NuxtLink></li>
            <li>
              <NuxtLink class="t1-body" to="#services">Projects</NuxtLink>
            </li>
            <li>
              <NuxtLink class="t1-body" to="#a-propos">Services</NuxtLink>
            </li>
            <li>
              <NuxtLink class="t1-body" to="#contact">Contact us</NuxtLink>
            </li>
          </ul>
        </div>

        <!-- Logo -->
        <div class="header-logo">
          <NuxtLink to="/"
            ><svg
              width="126"
              height="60"
              viewBox="0 0 126 60"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M55.105 30.7342C53.0786 30.7342 51.5346 30.0909 50.4731 28.8043C49.4439 27.4855 48.9292 25.7968 48.9292 23.7382C48.9292 23.0305 49.0096 22.1942 49.1704 21.2293C49.4599 19.5888 50.1354 17.9806 51.1969 16.4044C52.2583 14.7962 53.5771 13.4774 55.1532 12.4481C56.7615 11.4188 58.4341 10.9041 60.1711 10.9041C61.329 10.9041 62.1975 11.1454 62.7765 11.6278C63.3876 12.0782 63.6128 12.7054 63.452 13.5095C63.259 14.5067 62.5513 15.4716 61.329 16.4044C60.1389 17.3051 58.611 18.077 56.7454 18.7204C54.912 19.3315 52.966 19.7497 50.9074 19.9748L51.0039 19.3476C53.5771 18.9938 55.684 18.4148 57.3244 17.6106C58.9649 16.8065 59.9298 15.7772 60.2193 14.5228C60.2837 14.2011 60.3158 13.9759 60.3158 13.8473C60.3158 13.3005 60.0907 12.8984 59.6403 12.6411C59.19 12.3516 58.6593 12.2068 58.0481 12.2068C56.5042 12.2068 55.2176 12.8984 54.1883 14.2815C53.159 15.6646 52.4674 17.4498 52.1136 19.6371C51.9206 20.6342 51.8241 21.5831 51.8241 22.4837C51.8241 24.478 52.2583 26.0863 53.1268 27.3086C54.0274 28.4987 55.298 29.0938 56.9384 29.0938C58.7719 29.0938 60.3962 28.563 61.8115 27.5016H61.908C62.0045 27.5016 62.0849 27.5498 62.1493 27.6463C62.2458 27.7428 62.2458 27.8393 62.1493 27.9358C59.8977 29.8014 57.5496 30.7342 55.105 30.7342Z"
                fill="currentColor"
              />
              <path
                d="M27.7802 43.713C27.2012 43.713 26.7348 43.5844 26.381 43.3271C25.995 43.0697 25.802 42.6516 25.802 42.0726C25.802 41.5258 25.9789 41.1076 26.3327 40.8181C26.6866 40.5608 27.169 40.4322 27.7802 40.4322C29.1311 40.4322 30.2409 40.3678 31.1093 40.2392C31.9778 40.1105 32.7819 39.7728 33.5217 39.2259C34.6154 38.454 36.0467 36.8135 37.8158 34.3046C39.6171 31.7957 41.2736 29.1581 42.7854 26.3919C44.2972 23.5935 45.23 21.4545 45.5838 19.9748C45.7447 19.3637 45.8251 18.6882 45.8251 17.9484C45.8251 16.8548 45.5678 15.5682 45.0531 14.0885C44.7958 13.4774 44.6671 12.9949 44.6671 12.6411C44.6671 12.1908 44.8279 11.8209 45.1496 11.5314C45.4713 11.2097 45.8894 11.0489 46.4041 11.0489C47.6264 11.0489 48.2375 11.9334 48.2375 13.7025C48.2375 16.3401 46.983 20.1035 44.4741 24.9927C41.9974 29.8497 39.1346 34.1759 35.8859 37.9715C32.6372 41.7992 29.9353 43.713 27.7802 43.713ZM37.4299 35.6073C37.462 34.8675 37.4781 33.806 37.4781 32.4229C37.4781 26.3436 36.9795 21.6314 35.9824 18.2861C35.0174 14.9088 33.6826 13.2201 31.9778 13.2201C30.9807 13.2201 30.1765 13.8151 29.5654 15.0053C29.5332 15.1018 29.4367 15.15 29.2759 15.15C29.0507 15.15 28.9542 15.0535 28.9864 14.8605C30.2087 12.3516 31.7044 11.0971 33.4735 11.0971C34.8244 11.0971 35.9824 11.8691 36.9474 13.4131C37.9123 14.9248 38.6522 17.0156 39.1668 19.6854C39.6815 22.3229 39.9388 25.2822 39.9388 28.563C39.9388 29.2707 39.9066 30.3643 39.8423 31.8439L37.4299 35.6073Z"
                fill="currentColor"
              />
              <path
                d="M19.2636 30.8307C17.3659 30.8307 15.8702 30.1552 14.7765 28.8043C13.7151 27.4533 13.1843 25.6842 13.1843 23.4969C13.1843 22.4998 13.2647 21.6153 13.4256 20.8433C13.7794 18.9777 14.4549 17.289 15.452 15.7772C16.4491 14.2654 17.6553 13.0753 19.0706 12.2068C20.4859 11.3384 21.9816 10.9041 23.5577 10.9041C25.552 10.9041 27.0959 11.5796 28.1896 12.9306C29.2832 14.2493 29.83 15.9702 29.83 18.0931C29.83 18.9938 29.7335 19.9105 29.5405 20.8433C29.1545 22.8054 28.4308 24.5584 27.3693 26.1024C26.3079 27.6141 25.0534 28.7882 23.606 29.6245C22.1907 30.4286 20.7432 30.8307 19.2636 30.8307ZM20.9523 29.6245C22.3033 29.6245 23.5256 29.0294 24.6192 27.8393C25.7128 26.6492 26.4526 25.0248 26.8386 22.9662C26.9994 22.1942 27.0799 21.2614 27.0799 20.1678C27.0799 17.9484 26.6456 16.0506 25.7772 14.4745C24.9408 12.8662 23.7346 12.0621 22.1585 12.0621C20.7754 12.0621 19.5209 12.6732 18.3952 13.8955C17.3015 15.1178 16.5456 16.7422 16.1275 18.7686C15.9345 19.6692 15.838 20.6342 15.838 21.6635C15.838 23.8508 16.2883 25.7325 17.1889 27.3086C18.0896 28.8525 19.344 29.6245 20.9523 29.6245Z"
                fill="currentColor"
              />
              <path
                d="M0.279841 39.4672C0.215509 39.4672 0.151178 39.3868 0.0868471 39.2259C-0.00964972 39.0973 -0.0257325 39.0008 0.0385987 38.9364C1.48605 38.068 2.62793 36.7492 3.46423 34.9801C4.3327 33.2431 5.02426 30.9915 5.53891 28.2253L9.83302 3.90812C9.92952 3.32914 9.97776 2.83057 9.97776 2.41242C9.97776 1.67261 9.75261 1.19013 9.30229 0.964967C8.88413 0.707642 8.06391 0.578978 6.84162 0.578978C6.77729 0.578978 6.74512 0.482483 6.74512 0.28949C6.74512 0.0964968 6.77729 0 6.84162 0L8.8198 0.0482475C10.0421 0.112578 11.0071 0.144743 11.7147 0.144743C12.5832 0.144743 13.6286 0.112578 14.8509 0.0482475L16.6843 0C16.7808 0 16.829 0.0964968 16.829 0.28949C16.829 0.482483 16.7808 0.578978 16.6843 0.578978C15.655 0.578978 14.883 0.675475 14.3684 0.868468C13.8859 1.06146 13.516 1.3992 13.2587 1.88169C13.0013 2.332 12.7923 3.03965 12.6314 4.00461L8.57856 26.9226C8.09608 29.4637 7.53318 31.5062 6.88987 33.0501C6.24656 34.5941 5.41025 35.8485 4.38095 36.8135C3.35165 37.8106 2.0007 38.6952 0.328089 39.4672H0.279841Z"
                fill="currentColor"
              />
              <path
                d="M116.895 59.9652C115.145 59.9652 113.609 59.548 112.288 58.7134C110.967 57.8789 109.935 56.7083 109.193 55.2015C108.463 53.6947 108.098 51.9445 108.098 49.951C108.098 47.9226 108.463 46.1551 109.193 44.6483C109.935 43.1299 110.967 41.9535 112.288 41.119C113.609 40.2844 115.145 39.8672 116.895 39.8672C118.657 39.8672 120.198 40.2844 121.52 41.119C122.841 41.9535 123.873 43.1299 124.614 44.6483C125.356 46.1551 125.727 47.9226 125.727 49.951C125.727 51.9445 125.356 53.6947 124.614 55.2015C123.873 56.7083 122.841 57.8789 121.52 58.7134C120.198 59.548 118.657 59.9652 116.895 59.9652ZM116.895 57.2878C118.24 57.2878 119.341 56.9459 120.198 56.262C121.056 55.5782 121.694 54.6799 122.111 53.5672C122.528 52.4429 122.737 51.2375 122.737 49.951C122.737 48.6412 122.528 47.4242 122.111 46.2999C121.694 45.1757 121.056 44.2716 120.198 43.5877C119.341 42.8923 118.24 42.5446 116.895 42.5446C115.574 42.5446 114.484 42.8923 113.627 43.5877C112.769 44.2716 112.131 45.1757 111.714 46.2999C111.297 47.4242 111.088 48.6412 111.088 49.951C111.088 51.2375 111.297 52.4429 111.714 53.5672C112.131 54.6799 112.769 55.5782 113.627 56.262C114.484 56.9459 115.574 57.2878 116.895 57.2878Z"
                fill="currentColor"
              />
              <path
                d="M104.032 59.5479V40.1106H106.987V59.5479H104.032ZM105.527 36.8768C104.948 36.8768 104.449 36.6798 104.032 36.2857C103.615 35.8916 103.406 35.4164 103.406 34.86C103.406 34.3037 103.615 33.8285 104.032 33.4344C104.449 33.0403 104.948 32.8433 105.527 32.8433C106.107 32.8433 106.605 33.0403 107.022 33.4344C107.44 33.8285 107.648 34.3037 107.648 34.86C107.648 35.4164 107.44 35.8916 107.022 36.2857C106.605 36.6798 106.107 36.8768 105.527 36.8768Z"
                fill="currentColor"
              />
              <path
                d="M93.1208 59.9652C91.4981 59.9652 90.0667 59.5537 88.8265 58.7308C87.5863 57.9079 86.6185 56.743 85.923 55.2362C85.2276 53.7179 84.8799 51.9329 84.8799 49.8814C84.8799 47.8415 85.2276 46.0739 85.923 44.5787C86.6301 43.0719 87.6037 41.9129 88.8439 41.1016C90.084 40.2786 91.5213 39.8672 93.1555 39.8672C94.4305 39.8672 95.4331 40.0758 96.1633 40.493C96.9051 40.9103 97.473 41.3855 97.8671 41.9187C98.2612 42.4403 98.5683 42.8691 98.7886 43.2052H99.032V33.643H101.988V59.5479H99.1363V56.5576H98.7886C98.5683 56.9053 98.2554 57.3515 97.8497 57.8963C97.4441 58.4294 96.8645 58.9105 96.1111 59.3393C95.3693 59.7566 94.3726 59.9652 93.1208 59.9652ZM93.5033 57.2878C94.7087 57.2878 95.7229 56.9748 96.5458 56.3489C97.3687 55.7115 97.9946 54.8364 98.4235 53.7237C98.8523 52.5994 99.0667 51.307 99.0667 49.8466C99.0667 48.3862 98.8581 47.1113 98.4408 46.0217C98.0236 44.9206 97.3977 44.0687 96.5632 43.466C95.7402 42.8517 94.7203 42.5446 93.5033 42.5446C92.2515 42.5446 91.2083 42.8691 90.3738 43.5182C89.5393 44.1673 88.9134 45.0423 88.4961 46.1434C88.0789 47.2446 87.8702 48.4789 87.8702 49.8466C87.8702 51.2259 88.0789 52.4777 88.4961 53.602C88.925 54.7263 89.5567 55.6245 90.3912 56.2968C91.2257 56.9574 92.2631 57.2878 93.5033 57.2878Z"
                fill="currentColor"
              />
              <path
                d="M80.8224 51.62V40.1106H83.778V59.5479H80.8224V56.2446H80.6138C80.1501 57.2298 79.4373 58.0701 78.4753 58.7656C77.5249 59.461 76.3137 59.8029 74.8417 59.7913C73.6247 59.7913 72.5467 59.5306 71.6079 59.009C70.6691 58.4758 69.9273 57.6645 69.3825 56.575C68.8493 55.4855 68.5828 54.112 68.5828 52.4545V40.1106H71.5384V52.2807C71.5384 53.6831 71.9382 54.8074 72.738 55.6535C73.5493 56.4996 74.5751 56.9169 75.8153 56.9053C76.5571 56.9053 77.3105 56.7198 78.0754 56.3489C78.852 55.9665 79.5011 55.3869 80.0227 54.6104C80.5558 53.8222 80.8224 52.8254 80.8224 51.62Z"
                fill="currentColor"
              />
              <path
                d="M67.5102 40.1106V42.6489H57.4612V40.1106H67.5102ZM60.382 35.4859H63.3376V53.9845C63.3376 54.9929 63.5462 55.7347 63.9635 56.2099C64.3808 56.6735 65.0414 56.9053 65.9455 56.9053C66.1425 56.9053 66.3454 56.8937 66.554 56.8705C66.7742 56.8474 67.0118 56.8126 67.2668 56.7662L67.8927 59.4436C67.6145 59.548 67.2726 59.6291 66.8669 59.687C66.4728 59.7566 66.073 59.7914 65.6673 59.7914C64.1026 59.7914 62.8276 59.3277 61.8424 58.4005C60.8688 57.4732 60.382 56.2678 60.382 54.7842V35.4859Z"
                fill="currentColor"
              />
              <path
                d="M48.4277 60C46.5732 60 44.9679 59.7044 43.6118 59.1133C42.2557 58.5106 41.1894 57.6761 40.4128 56.6097C39.6478 55.5318 39.2132 54.2858 39.1089 52.8718H42.3427C42.4354 53.8454 42.7657 54.6509 43.3336 55.2884C43.9132 55.9259 44.6492 56.4011 45.5417 56.7141C46.4341 57.027 47.3961 57.1835 48.4277 57.1835C49.6215 57.1835 50.6937 56.9864 51.6441 56.5924C52.6061 56.1983 53.3653 55.6477 53.9216 54.9407C54.478 54.2337 54.7562 53.405 54.7562 52.4545C54.7562 51.5968 54.5127 50.9014 54.0259 50.3682C53.5391 49.8351 52.9017 49.4004 52.1135 49.0643C51.3369 48.7282 50.4908 48.4326 49.5752 48.1776L46.4109 47.2735C44.3826 46.694 42.7773 45.8653 41.5951 44.7874C40.4244 43.6979 39.8391 42.278 39.8391 40.5278C39.8391 39.079 40.2274 37.8156 41.0039 36.7377C41.7921 35.6482 42.8526 34.8021 44.1856 34.1994C45.5301 33.5967 47.0252 33.2953 48.6711 33.2953C50.3401 33.2953 51.8237 33.5967 53.1219 34.1994C54.42 34.7905 55.4516 35.6018 56.2166 36.6334C56.9815 37.6534 57.3872 38.8124 57.4336 40.1106H54.3737C54.223 38.8356 53.6087 37.8446 52.5308 37.1376C51.4644 36.4306 50.1431 36.0771 48.5668 36.0771C47.4309 36.0771 46.4341 36.2625 45.5764 36.6334C44.7187 37.0043 44.0523 37.5143 43.5771 38.1634C43.1018 38.8124 42.8642 39.5542 42.8642 40.3887C42.8642 41.3044 43.1482 42.0462 43.7161 42.6141C44.2841 43.1705 44.9563 43.6051 45.7329 43.9181C46.5211 44.231 47.2339 44.4802 47.8714 44.6657L50.4792 45.3959C51.1515 45.5813 51.8991 45.8305 52.722 46.1435C53.5565 46.4564 54.3563 46.8795 55.1213 47.4126C55.8978 47.9458 56.5353 48.6296 57.0337 49.4642C57.5321 50.2871 57.7813 51.3071 57.7813 52.5241C57.7813 53.9149 57.4162 55.1783 56.686 56.3142C55.9558 57.4385 54.8952 58.3367 53.5044 59.009C52.1135 59.6697 50.4213 60 48.4277 60Z"
                fill="currentColor"
              />
            </svg>
          </NuxtLink>
        </div>

        <!-- Contact button -->
        <div class="header-contact">
          <NuxtLink class="t1-body" to="#contact">Get in touch</NuxtLink>
        </div>
      </nav>
    </div>
  </header>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from "vue";

interface Theme {
  text: string;
  bg: string;
}

const themes = {
  light: { text: "#000000", bg: "#ffffff" },
  dark: { text: "#ffffff", bg: "#000000" },
};

const props = defineProps<{
  theme?: "light" | "dark";
}>();

const currentTheme = ref<Theme>(themes[props.theme || "light"]);
const isScrolled = ref(false);

// Fonction pour détecter le scroll
const handleScroll = () => {
  isScrolled.value = window.scrollY > 50;
};

// Fonction pour détecter la section sous le header
const detectSection = () => {
  const header = document.querySelector(".header") as HTMLElement;
  if (!header) return;

  const headerBottom = header.getBoundingClientRect().bottom;
  const sections = document.querySelectorAll("[data-theme]");

  sections.forEach((section) => {
    const rect = section.getBoundingClientRect();
    // Si la section est sous le header
    if (rect.top < headerBottom && rect.bottom > headerBottom) {
      const sectionTheme = section.getAttribute("data-theme") as
        | "light"
        | "dark";
      if (sectionTheme && themes[sectionTheme]) {
        currentTheme.value = themes[sectionTheme];
      }
    }
  });
};

onMounted(() => {
  window.addEventListener("scroll", handleScroll);
  window.addEventListener("scroll", detectSection);
  detectSection(); // Initial check
});

onUnmounted(() => {
  window.removeEventListener("scroll", handleScroll);
  window.removeEventListener("scroll", detectSection);
});

// Méthode exposée pour changer le thème manuellement
defineExpose({
  setTheme: (theme: "light" | "dark") => {
    currentTheme.value = themes[theme];
  },
});
</script>

<style scoped>
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  padding: 30px 0;
  transition: color 0.3s ease;
  color: var(--theme-text);
}

.header-nav {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
}

.header-menu {
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.menu-list {
  display: flex;
  gap: 40px;
  list-style: none;
  margin: 0;
  padding: 0;
}

.menu-list a {
  color: var(--theme-text);
  text-decoration: none;
  transition: color 0.3s ease;
  position: relative;
}

.menu-list a:hover {
  opacity: 0.7;
}

.menu-list a::after {
  content: "";
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 0;
  height: 1px;
  background: var(--theme-text);
  transition: width 0.3s ease;
}

.menu-list a:hover::after {
  width: 100%;
}

.header-logo {
  display: flex;
  justify-content: center;
  align-items: center;
}

.header-logo a {
  font-size: 24px;
  font-weight: 700;
  color: var(--theme-text);
  text-decoration: none;
  transition: color 0.3s ease;
}

.header-logo a:hover {
  opacity: 0.7;
}

.header-contact {
  display: flex;
  justify-content: flex-end;
  align-items: center;
}

@media (max-width: 768px) {
  .header {
    padding: 20px 0;
  }

  .header-nav {
    grid-template-columns: 1fr;
  }

  .header-logo {
    grid-column: span 3;
    text-align: center;
    margin-bottom: 20px;
  }

  .header-menu {
    grid-column: span 3;
    justify-content: center;
  }

  .menu-list {
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .menu-list a {
    font-size: 14px;
  }
}
</style>
